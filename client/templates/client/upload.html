{% extends 'client/base.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card shadow">
            <div class="card-body">
                <h4 class="card-title mb-4">ğŸ“¸ ä¸Šå‚³ç™¼ç¥¨</h4>
                <div class="mb-3">
                    <label for="imageUpload" class="form-label">é¸æ“‡åœ–ç‰‡</label>
                    <input type="file" class="form-control" id="imageUpload" accept="image/*">
                </div>
                <div class="d-grid">
                    <button id="processBtn" class="btn btn-primary btn-lg">é–‹å§‹è¾¨è­˜</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('processBtn').onclick = async () => {
    const file = document.getElementById('imageUpload').files[0];
    if (!file) return alert('è«‹å…ˆé¸æ“‡æª”æ¡ˆ');

    const formData = new FormData();
    formData.append('image', file);

    try {
        const response = await fetch('/api/process/', {
            method: 'POST',
            body: formData
        });
        const result = await response.json();
        if (result.success) {
            sessionStorage.setItem('invoiceData', JSON.stringify(result.data));
            window.location.href = '/client/confirm/';
        } else {
            alert('è¾¨è­˜å¤±æ•—: ' + result.error);
        }
    } catch (e) {
        alert('é€£ç·šéŒ¯èª¤');
    }
};
</script>
{% endblock %}
