{% load static %}
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Receipt AI - Camera & Edit</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'client/css/style.css' %}">
</head>
<body>
    <div class="m-4">
        <h4 class="text-center mb-3">發票拍攝與修圖</h4>
        <div class="row g-3">

            <!-- ================= 左側：Camera ================= -->
            <div class="col-12 col-md-6">

                <!-- 即時相機 -->
                <div class="position-relative">
                    <video id="video" autoplay muted playsinline></video>
                    <canvas id="overlay"></canvas>
                    <canvas id="captureCanvas" class="d-none"></canvas>
                </div>

                <!-- 拍攝品質 -->
                <div class="panel mt-2">
                    <div class="metric">清晰度 <span id="sharpnessMetric">--</span></div>
                    <div class="metric">亮度 <span id="brightnessMetric">--</span></div>
                    <div class="metric">對比度 <span id="contrastMetric">--</span></div>
                    <div id="hint" class="mt-2 text-secondary">請將發票完整置於畫面中</div>
                </div>

                <!-- Camera Controls -->
                <div class="d-flex gap-2 mt-2">
                    <button id="startBtn" class="btn btn-primary w-100">開啟</button>
                    <button id="captureBtn" class="btn btn-secondary w-100">拍照</button>
                    <button id="stopBtn" class="btn btn-dark w-100">關閉</button>
                </div>

                <!-- Zoom -->
                <div class="mt-2">
                    <label class="form-label mb-1">數位 / 硬體變焦</label>
                    <input type="range" id="zoomSlider" class="form-range" min="1" max="3" step="0.1" value="1">
                </div>

            </div>

            <!-- ================= 右側：Upload / Preview / Edit ================= -->
            <div class="col-12 col-md-6">

                <div class="panel">

                    <!-- Upload -->
                    <label class="btn btn-outline-light w-100 mb-2">
                        上傳圖片
                        <input id="fileInput" type="file" accept="image/*" capture hidden>
                    </label>

                    <!-- Preview Image -->
                    <img id="previewImage" class="d-none mb-2" alt="preview">

                    <!-- Edit Canvas -->
                    <canvas id="editCanvas" class="d-none mb-2"></canvas>

                    <!-- Edit Sliders -->
                    <div id="editControls" class="d-none">
                        <div class="mt-2">
                            <label>亮度</label>
                            <input type="range" id="brightness" min="-50" max="50" value="0" class="form-range">
                        </div>
                        <div class="mt-2">
                            <label>對比</label>
                            <input type="range" id="contrast" min="-50" max="50" value="0" class="form-range">
                        </div>
                        <div class="mt-2">
                            <label>銳利化</label>
                            <input type="range" id="sharpness" min="0" max="5" step="0.1" value="0" class="form-range">
                        </div>
                    </div>

                    <!-- Actions -->
                    <div id="previewActions" class="d-none mt-3">
                        <button id="uploadBtn" class="btn btn-success w-100 mb-2">確認上傳</button>
                        <button id="cancelBtn" class="btn btn-outline-light w-100">取消</button>
                    </div>

                    <!-- Empty -->
                    <div id="previewEmpty" class="text-center text-secondary mt-3">尚未拍照或上傳圖片</div>

                </div>
            </div>

        </div>
    </div>

    <!-- JS 之後再接 -->
    <script src="{% static 'client/js/ios.js' %}"></script>

</body>
</html>
